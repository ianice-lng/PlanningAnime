<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planning Anime</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
   
</head>
<body>
    <h1 class="liste-title">Liste des sorties d'anime de la semaine</h1>
    <ul class="liste-button-semaine">
        <li class="">
            <button class="active" onclick="rechercheDay('lundi')" class="">Lundi</button>
        </li>
        <li class="">
            <button onclick="rechercheDay('mardi')" class="">Mardi</button>
        </li>
        <li class="">
            <button  onclick="rechercheDay('mercredi')" class="">Mercredi</button>
        </li>
        <li class="">
            <button onclick="rechercheDay('jeudi')" class="">Jeudi</button>
        </li>
        <li class="">
            <button onclick="rechercheDay('vendredi')" class="">Vendredi</button>
        </li>
        <li class="">
            <button onclick="rechercheDay('samedi')" class="">Samedi</button>
        </li>
        <li>
            <button onclick="rechercheDay('dimanche')" class="">Dimanche</button>
        </li>
    </ul>
    <div id="root" >
    </div>
    <footer>
        <p>© 2024 - Réalisé par Zaphir<br>L'API utilisé pour faire ce planning est l'API de FRAnime<br>Hébergé par Github Page</p>
        <a href="https://github.com/zaphir21" target="_blank"><img src="github.svg" alt="logo github" class="logo"></a>
    </footer>
    <script>
    //Fonction pour récupérer les données de l'API FRAnime  
        const data = async (day) => {
    const response = await fetch("https://api.franime.fr/api/calendrier_data")
    const json = await response.json()
    const DivRootNode = document.querySelector("#root")
    DivRootNode.textContent = ""
    json.data.forEach(anime => {
    // Système d'ajout d'anime dans le DOM en fonction du jour voulu
        
        if(anime.jour === day){
            const aAnime = document.createElement("a")
            const img = document.createElement("img")
            img.src = anime.affiche
            img.className = "affiche"
            aAnime.className = "anime"
            aAnime.href = anime.url_access_anime_page
            aAnime.target = "_blank"
            const h1Title = document.createElement("p")
            h1Title.className = "title" 
            const titleAnime = anime.title_anime
            const date = document.createElement("p")
            date.className = "date"
            date.textContent = `${anime.heures}h${anime.minutes < 10 ? "0" + anime.minutes : anime.minutes}`
            const numEpisode = document.createElement("p")
            numEpisode.className = "episode"
            numEpisode.textContent = `Episode ${anime.prochain_ep}`
            const saison = document.createElement("p")
            saison.className = "saison"
            saison.textContent = `S${anime.saison}`
            const langue = document.createElement("p")
            langue.className = "langue" 
            langue.textContent = anime.lang.toUpperCase()
            // Limiter le nombre de caractères du titre
            if(titleAnime.length <= 22){
            h1Title.textContent = titleAnime}
            else{
                h1Title.textContent = `${titleAnime.substr(0,26)} ...`
            }

            //modifier le DOM
            const divImage = document.createElement("div")
            divImage.className = "divImage"

            divImage.appendChild(langue)
            divImage.appendChild(date)
            divImage.appendChild(numEpisode)
            divImage.appendChild(saison)
            divImage.appendChild(img)
            aAnime.appendChild(divImage)
            aAnime.appendChild(h1Title)
            DivRootNode.appendChild(aAnime)
        }
    })
}
//Afficher les animes de lundi par défaut
data("lundi")
//Ajouter la classe active au bouton cliqué
const buttons = document.querySelectorAll("button")
buttons.forEach(button => {
    button.addEventListener("click", (buttonSelect) => {
        buttons.forEach(button => {
            button.className = ""
        })
        buttonSelect.target.className = "active"
    })
})
//Fonction de recherche des animes en fonction du jour
const rechercheDay = (day) => {
    data(day);
}
    </script>
</body>
</html>